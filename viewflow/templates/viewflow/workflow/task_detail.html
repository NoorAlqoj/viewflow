{% extends request.resolver_match.app.base_template_name|default:'viewflow/workflow/base_page.html' %}
{% load i18n viewflow workflow %}

{% block content %}{% with process=request.activation.process task=request.activation.task %}
<div class="mdc-layout-grid vf-page__grid">
  <div class="mdc-layout-grid__inner">
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
      <div class="mdc-card vf-card">
        <section class="vf-card__header">
          <h1 class="vf-card__title">
              {{ task.flow_task.task_description|default:task.flow_task.task_title }}
          </h1>
          <h2 class="vf-card__breadcrumbs">
            {% block breadcrumbs_items %}
              <a href="{% reverse viewset 'index' %}">{{ process.flow_class.process_title }}</a>
              <a href="{% reverse viewset 'process_detail' process.pk %}">#{{ process.pk }}</a>
              <a>{{ task.flow_task.task_title }} #{{ task.pk}}</a>
            {% endblock %}
          </h2>
        </section>

        <section class="vf-card__body">
          <div class="mdc-layout-grid" style="padding-top: 0;padding-left: 16px;padding-right:16px;">
            <div class="mdc-layout-grid__inner">
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
                <mwc-textfield label="Brief" icon="description" disabled value="{{ task.brief|default:task.flow_task.task_description|default:task.flow_task.task_title }}" style="width:100%"></mwc-textfield>
              </div>
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                <mwc-textfield label="Owner" icon="account_box" disabled value="{{ task.owner|default:"Unassigned" }}" style="width:100%"></mwc-textfield>
              </div>
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                <mwc-textfield label="Permission" icon="lock" disabled value="{{ task.owner_permission }} {{ task.owner_permission_obj|default:"" }}" style="width:100%"></mwc-textfield>
              </div>
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">
                <mwc-textfield label="Created" icon="schedule" disabled value="{{ task.created|timesince }}" style="width:100%"></mwc-textfield>
              </div>
              <div class="mdc-layout-grid__cell  mdc-layout-grid__cell--span-4">
                <mwc-textfield label="Assigned" icon="update" disabled value="{{ task.assigned|timesince }}" style="width:100%"></mwc-textfield>
              </div>
              <div class="mdc-layout-grid__cell  mdc-layout-grid__cell--span-4">
                <mwc-textfield label="Finished" icon="watch_later" disabled value="{{ task.finished|timesince }}" style="width:100%"></mwc-textfield>
              </div>
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                <h4 class="mdc-typography mdc-typography--headline5" style="margin-bottom:10px">Previous tasks</h4>
                <div>
                  {% for prev_task in task.previous.all %}
                    <a class="mdc-typography mdc-typography--subtitle1" href="{% reverse prev_task.flow_task 'index' process.pk prev_task.pk %}">{{ prev_task.flow_task.task_description|default:prev_task.flow_task }}</a>{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </div>
              </div>
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                <h4 class="mdc-typography mdc-typography--headline5"  style="margin-bottom:10px">Next tasks</h4>
                <div>
                  {% for next_task in task.leading.all %}
                  <a class="mdc-typography mdc-typography--subtitle1" href="{% reverse next_task.flow_task 'index' process.pk next_task.pk %}">{{ prev_task.next_task.task_description|default:next_task.flow_task }}</a>{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="mdc-card__actions vf-card__actions">
          <a class="mdc-button mdc-button--touch" href="{# reverse task.flow_task 'assign' process.pk task.pk #}">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__touch"></span>
            <span class="mdc-button__focus-ring"></span>
            <span class="mdc-button__label">{% trans 'Assign' %}</span>
          </a>
          <a class="mdc-button mdc-button--touch" href="{# reverse task.flow_task 'execute' process.pk task.pk #}">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__touch"></span>
            <span class="mdc-button__focus-ring"></span>
            <span class="mdc-button__label">{% trans 'Execute' %}</span>
          </a>
        </section>
      </div>
    </div>
    {% block panel-cell %}
    <div class="mdc-layout-grid__cell {% block panel-cell-span %}mdc-layout-grid__cell--span-4-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone{% endblock %}">
      {% include_process_data request.activation.process %}
    </div>
    {% endblock panel-cell %}
  </div>
</div>
{% endwith %}{% endblock %}
